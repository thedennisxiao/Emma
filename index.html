<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>A Question Under the Stars</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body, html {
            width: 100%;
            height: 100%;
            overflow: hidden;
            font-family: 'Georgia', serif;
        }

        #scene-container {
            position: relative;
            width: 100%;
            height: 100%;
            background: linear-gradient(
                to bottom,
                #0a0e27 0%,
                #1a1f3a 30%,
                #2a2f4a 60%,
                #1a1f35 100%
            );
        }

        /* SVG Trees Container */
        #trees-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 10;
        }

        /* Left tree group */
        .tree-left {
            position: absolute;
            top: 0;
            left: 0;
            opacity: 0.95;
        }

        /* Right tree group */
        .tree-right {
            position: absolute;
            top: 0;
            right: 0;
            opacity: 0.95;
        }

        /* Star canvas - behind trees, above background */
        #star-canvas {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1;
        }

        /* Content area - centered and framed by trees */
        #content-area {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 60%;
            max-width: 800px;
            height: 60%;
            z-index: 5;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* Responsive adjustments */
        @media (max-width: 768px) {
            #content-area {
                width: 80%;
                height: 70%;
            }
        }

        @media (max-width: 480px) {
            #content-area {
                width: 90%;
                height: 75%;
            }
        }
    </style>
</head>
<body>
    <div id="scene-container">
        <!-- Star Field Canvas -->
        <canvas id="star-canvas"></canvas>

        <!-- Trees SVG Container -->
        <div id="trees-container">
            <!-- Left side trees (Douglas Fir) -->
            <svg class="tree-left" width="400" height="100%" viewBox="0 0 400 800" preserveAspectRatio="xMinYMin meet">
                <!-- Douglas Fir silhouette - left side -->
                <g fill="#0a0d1a" opacity="0.9">
                    <!-- Main trunk -->
                    <path d="M 50 800 L 50 300 L 70 300 L 70 800 Z"/>

                    <!-- Branches - layered triangular shapes for fir appearance -->
                    <path d="M 60 320 L 20 380 L 100 380 Z"/>
                    <path d="M 60 360 L 15 430 L 105 430 Z"/>
                    <path d="M 60 410 L 10 490 L 110 490 Z"/>
                    <path d="M 60 470 L 5 560 L 115 560 Z"/>
                    <path d="M 60 540 L 0 630 L 120 630 Z"/>
                    <path d="M 60 610 L 0 710 L 120 710 Z"/>
                </g>

                <!-- Western Red Cedar - left side, slightly behind -->
                <g fill="#0d1020" opacity="0.85">
                    <path d="M 180 800 L 180 250 L 195 250 L 195 800 Z"/>

                    <!-- Cedar has a more irregular, drooping branch pattern -->
                    <path d="M 187 270 L 150 310 L 160 310 L 140 340 L 230 340 L 210 310 L 220 310 Z"/>
                    <path d="M 187 320 L 145 365 L 155 365 L 135 400 L 240 400 L 220 365 L 230 365 Z"/>
                    <path d="M 187 380 L 140 430 L 150 430 L 130 470 L 250 470 L 230 430 L 240 430 Z"/>
                    <path d="M 187 450 L 135 505 L 145 505 L 125 550 L 260 550 L 240 505 L 250 505 Z"/>
                    <path d="M 187 530 L 130 590 L 140 590 L 120 640 L 270 640 L 250 590 L 260 590 Z"/>
                    <path d="M 187 620 L 125 685 L 135 685 L 115 740 L 280 740 L 260 685 L 270 685 Z"/>
                </g>
            </svg>

            <!-- Right side trees (Douglas Fir and Western Red Cedar) -->
            <svg class="tree-right" width="400" height="100%" viewBox="0 0 400 800" preserveAspectRatio="xMaxYMin meet">
                <!-- Douglas Fir silhouette - right side -->
                <g fill="#0a0d1a" opacity="0.9">
                    <!-- Main trunk -->
                    <path d="M 330 800 L 330 300 L 350 300 L 350 800 Z"/>

                    <!-- Branches -->
                    <path d="M 340 320 L 300 380 L 380 380 Z"/>
                    <path d="M 340 360 L 295 430 L 385 430 Z"/>
                    <path d="M 340 410 L 290 490 L 390 490 Z"/>
                    <path d="M 340 470 L 285 560 L 395 560 Z"/>
                    <path d="M 340 540 L 280 630 L 400 630 Z"/>
                    <path d="M 340 610 L 280 710 L 400 710 Z"/>
                </g>

                <!-- Western Red Cedar - right side -->
                <g fill="#0d1020" opacity="0.85">
                    <path d="M 205 800 L 205 250 L 220 250 L 220 800 Z"/>

                    <!-- Cedar branches -->
                    <path d="M 212 270 L 180 310 L 190 310 L 170 340 L 260 340 L 240 310 L 250 310 Z"/>
                    <path d="M 212 320 L 175 365 L 185 365 L 160 400 L 270 400 L 245 365 L 255 365 Z"/>
                    <path d="M 212 380 L 170 430 L 180 430 L 150 470 L 280 470 L 250 430 L 260 430 Z"/>
                    <path d="M 212 450 L 165 505 L 175 505 L 140 550 L 290 550 L 255 505 L 265 505 Z"/>
                    <path d="M 212 530 L 160 590 L 170 590 L 130 640 L 300 640 L 260 590 L 270 590 Z"/>
                    <path d="M 212 620 L 155 685 L 165 685 L 120 740 L 310 740 L 265 685 L 275 685 Z"/>
                </g>
            </svg>
        </div>

        <!-- Content Area (framed by trees) -->
        <div id="content-area">
            <!-- Future phases will add stars and interactive elements here -->
        </div>
    </div>

    <script>
        // ===== PHASE 3: TEXT FORMATION ANIMATION =====

        // Canvas setup
        const canvas = document.getElementById('star-canvas');
        const ctx = canvas.getContext('2d');

        // Animation configuration
        const STAR_COUNT = 85; // 75-100 stars
        const ANIMATION_DURATION = 2.5; // seconds
        const stars = [];
        let animationStartTime = null;
        let isAnimating = false;

        // Star class for managing individual stars
        class Star {
            constructor(x, y, radius, color, twinkleSpeed, twinkleOffset) {
                // Current position
                this.x = x;
                this.y = y;

                // Initial random position (for animation start)
                this.startX = x;
                this.startY = y;

                // Target position (for text formation)
                this.targetX = x;
                this.targetY = y;

                this.radius = radius;
                this.color = color;
                this.twinkleSpeed = twinkleSpeed;
                this.twinkleOffset = twinkleOffset;
            }

            // Set target position for text formation
            setTarget(targetX, targetY) {
                this.targetX = targetX;
                this.targetY = targetY;
            }

            // Update position based on animation progress
            updatePosition(progress) {
                // Ease-in-out cubic function
                const eased = progress < 0.5
                    ? 4 * progress * progress * progress
                    : 1 - Math.pow(-2 * progress + 2, 3) / 2;

                this.x = this.startX + (this.targetX - this.startX) * eased;
                this.y = this.startY + (this.targetY - this.startY) * eased;
            }

            // Calculate opacity based on time for twinkle effect
            getOpacity(time) {
                // Sine wave for smooth pulsing (0.5 to 1.0 opacity range)
                return 0.5 + 0.5 * Math.sin(time * this.twinkleSpeed + this.twinkleOffset);
            }

            draw(time) {
                ctx.beginPath();
                ctx.arc(this.x, this.y, this.radius, 0, Math.PI * 2);
                ctx.fillStyle = this.color;
                ctx.globalAlpha = this.getOpacity(time);
                ctx.fill();
                ctx.globalAlpha = 1.0; // Reset alpha
            }
        }

        // Simple dot-matrix letter definitions (5x7 grid)
        // Each letter is an array of [x, y] coordinates
        const LETTERS = {
            'W': [[0,0],[0,1],[0,2],[0,3],[0,4],[0,5],[0,6],[1,5],[2,4],[2,5],[2,6],[3,5],[4,0],[4,1],[4,2],[4,3],[4,4],[4,5],[4,6]],
            'I': [[0,0],[1,0],[2,0],[2,1],[2,2],[2,3],[2,4],[2,5],[0,6],[1,6],[2,6],[3,6],[4,6]],
            'L': [[0,0],[0,1],[0,2],[0,3],[0,4],[0,5],[0,6],[1,6],[2,6],[3,6],[4,6]],
            'Y': [[0,0],[0,1],[0,2],[1,2],[2,3],[2,4],[2,5],[2,6],[3,2],[4,0],[4,1],[4,2]],
            'O': [[1,0],[2,0],[3,0],[0,1],[4,1],[0,2],[4,2],[0,3],[4,3],[0,4],[4,4],[0,5],[4,5],[1,6],[2,6],[3,6]],
            'U': [[0,0],[0,1],[0,2],[0,3],[0,4],[0,5],[1,6],[2,6],[3,6],[4,0],[4,1],[4,2],[4,3],[4,4],[4,5]],
            'B': [[0,0],[0,1],[0,2],[0,3],[0,4],[0,5],[0,6],[1,0],[2,0],[3,0],[4,1],[4,2],[3,3],[2,3],[1,3],[4,4],[4,5],[3,6],[2,6],[1,6]],
            'E': [[0,0],[0,1],[0,2],[0,3],[0,4],[0,5],[0,6],[1,0],[2,0],[3,0],[4,0],[1,3],[2,3],[3,3],[1,6],[2,6],[3,6],[4,6]],
            'M': [[0,0],[0,1],[0,2],[0,3],[0,4],[0,5],[0,6],[1,1],[2,2],[3,1],[4,0],[4,1],[4,2],[4,3],[4,4],[4,5],[4,6]],
            'P': [[0,0],[0,1],[0,2],[0,3],[0,4],[0,5],[0,6],[1,0],[2,0],[3,0],[4,1],[4,2],[3,3],[2,3],[1,3]],
            'A': [[2,0],[1,1],[3,1],[0,2],[4,2],[0,3],[4,3],[1,3],[2,3],[3,3],[0,4],[4,4],[0,5],[4,5],[0,6],[4,6]],
            'R': [[0,0],[0,1],[0,2],[0,3],[0,4],[0,5],[0,6],[1,0],[2,0],[3,0],[4,1],[4,2],[3,3],[2,3],[1,3],[2,4],[3,5],[4,6]],
            'T': [[0,0],[1,0],[2,0],[3,0],[4,0],[2,1],[2,2],[2,3],[2,4],[2,5],[2,6]],
            'N': [[0,0],[0,1],[0,2],[0,3],[0,4],[0,5],[0,6],[1,1],[2,2],[2,3],[3,4],[4,0],[4,1],[4,2],[4,3],[4,4],[4,5],[4,6]],
            '?': [[1,0],[2,0],[3,0],[0,1],[4,1],[4,2],[3,3],[2,4],[2,6]],
            ' ': []
        };

        // Initialize canvas size
        function resizeCanvas() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
        }

        // Generate text positions from letter definitions
        function generateTextPositions(text, centerX, centerY, dotSize) {
            const positions = [];
            const lines = text.split('\n');
            const lineHeight = 9 * dotSize;
            const totalHeight = lines.length * lineHeight;
            let startY = centerY - totalHeight / 2;

            lines.forEach((line, lineIndex) => {
                line = line.toUpperCase();
                const lineWidth = line.split('').reduce((width, char) => {
                    return width + (char === ' ' ? 4 : 6);
                }, -1) * dotSize;

                let startX = centerX - lineWidth / 2;
                let currentX = startX;

                for (let char of line) {
                    const letterDots = LETTERS[char] || [];
                    letterDots.forEach(([dx, dy]) => {
                        positions.push({
                            x: currentX + dx * dotSize,
                            y: startY + lineIndex * lineHeight + dy * dotSize
                        });
                    });
                    currentX += (char === ' ' ? 4 : 6) * dotSize;
                }
            });

            return positions;
        }

        // Generate stars with random positions
        function generateStars() {
            stars.length = 0;

            const width = canvas.width;
            const height = canvas.height;

            // Avoid tree areas
            const safeMarginX = width * 0.15;
            const safeStartX = safeMarginX;
            const safeEndX = width - safeMarginX;
            const safeWidth = safeEndX - safeStartX;

            // Create stars with variation
            for (let i = 0; i < STAR_COUNT; i++) {
                const x = safeStartX + Math.random() * safeWidth;
                const y = Math.random() * height;
                const radius = 0.8 + Math.random() * 1.7;

                const colorChoice = Math.random();
                let color;
                if (colorChoice < 0.7) {
                    color = `rgb(255, 255, ${240 + Math.floor(Math.random() * 15)})`;
                } else {
                    color = `rgb(${220 + Math.floor(Math.random() * 35)}, ${230 + Math.floor(Math.random() * 25)}, 255)`;
                }

                const twinkleSpeed = 0.3 + Math.random() * 0.5;
                const twinkleOffset = Math.random() * Math.PI * 2;

                stars.push(new Star(x, y, radius, color, twinkleSpeed, twinkleOffset));
            }

            // Set text formation targets
            setTextTargets();
        }

        // Set target positions for text formation
        function setTextTargets() {
            const centerX = canvas.width / 2;
            const centerY = canvas.height / 2;
            const dotSize = Math.min(canvas.width, canvas.height) * 0.012; // Responsive sizing

            const text = "Will you\nbe my partner?";
            const positions = generateTextPositions(text, centerX, centerY, dotSize);

            // Assign positions to stars
            stars.forEach((star, i) => {
                if (i < positions.length) {
                    star.setTarget(positions[i].x, positions[i].y);
                } else {
                    // Extra stars stay in random positions
                    star.setTarget(star.startX, star.startY);
                }
            });
        }

        // Start text formation animation
        function startTextFormation() {
            if (!isAnimating) {
                isAnimating = true;
                animationStartTime = Date.now() / 1000;
                console.log('Starting text formation animation...');
            }
        }

        // Animation loop
        let animationId;
        function animate() {
            const time = Date.now() * 0.001;

            // Clear canvas
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            // Update star positions if animating
            if (isAnimating) {
                const elapsed = time - animationStartTime;
                const progress = Math.min(elapsed / ANIMATION_DURATION, 1.0);

                stars.forEach(star => star.updatePosition(progress));

                if (progress >= 1.0) {
                    isAnimating = false;
                    console.log('Text formation complete: "Will you be my partner?"');
                }
            }

            // Draw all stars
            stars.forEach(star => star.draw(time));

            animationId = requestAnimationFrame(animate);
        }

        // Handle window resize
        window.addEventListener('resize', () => {
            resizeCanvas();
            generateStars();
        });

        // Initialize scene
        function init() {
            resizeCanvas();
            generateStars();
            animate();

            // Start text formation after 1 second
            setTimeout(() => {
                startTextFormation();
            }, 1000);

            console.log('Emma Partner Proposal - Phase 3: Text Formation Ready');
        }

        // Start when page loads
        window.addEventListener('load', init);
    </script>
</body>
</html>
